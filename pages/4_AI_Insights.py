import streamlit as st
import utils 

# --- State Management and Sidebar ---
st.set_page_config(page_title="AI Insights", page_icon="🤖", layout="wide")
st.markdown(utils.load_css(), unsafe_allow_html=True)

# Check if data has been loaded from the Home page
if 'data_loaded' not in st.session_state or not st.session_state.data_loaded:
    st.warning("Please select and load a data source from the 🏠 Home page first.")
    st.stop()

# If data is loaded, get it from session state
df = st.session_state.df_enhanced
models = st.session_state.models

# --- Page Content ---
st.header("🤖 AI-Powered Insights")
st.info(f"This section provides automated insights generated by analyzing the **{st.session_state.source_name}** dataset.")

# UPDATED: Pass the 'models' dictionary to the function
insights = utils.generate_insights(df, models)

if not insights:
    st.warning("Could not generate any advanced insights. The dataset may be too small or lack sufficient variation for the AI models to find patterns.")
else:
    for insight in insights:
        st.markdown(f"""
        <div class="insight-box">
            <p>{insight}</p>
        </div>
        """, unsafe_allow_html=True)